import React, { useState } from "react";
import {
  View,
  TouchableOpacity,
  StyleSheet,
  GestureResponderEvent,
} from "react-native";
import { SvgXml } from "react-native-svg";
import { lightColors } from "../../../../theme";

type Tab = "reels" | "shop" | "offers" | "Commint" | "Policy";

interface Props {
  activeTab: Tab;
  onTabChange: (tab: Tab) => void;
  onReelsSortChange?: (sort: "popular" | "oldest") => void;
}

const svgReels = `<svg width="23" height="25" viewBox="0 0 23 25" fill="none" xmlns="http://www.w3.org/2000/svg">
<path opacity="0.8" d="M17.3711 0C20.3692 0 22.7998 2.6554 22.7998 5.93066V18.9775C22.7997 22.2527 20.3692 24.9082 17.3711 24.9082H5.42871C2.43066 24.9082 9.67739e-05 22.2527 0 18.9775V5.93066C0 2.6554 2.4306 5.27865e-06 5.42871 0H17.3711ZM1.9541 18.9775C1.9542 21.0736 3.50998 22.7725 5.42871 22.7725H17.3711C19.2898 22.7725 20.8456 21.0736 20.8457 18.9775V8.30273H1.9541V18.9775ZM8.41406 11.2305C8.41438 10.7742 8.86674 10.4896 9.22852 10.7178L14.9287 14.3125C15.2905 14.5408 15.2906 15.1116 14.9287 15.3398L9.22852 18.9346C8.86661 19.1628 8.41406 18.8774 8.41406 18.4209V11.2305ZM5.05273 2.15625C3.31073 2.36098 1.9541 3.97324 1.9541 5.93066V6.16797H7.99121L5.05273 2.15625ZM10.3945 6.08008L10.25 6.16797H15.0488L12.0947 2.13477H7.50586L10.3945 6.08008ZM17.4512 6.08008L17.3066 6.16797H20.8457V5.93066C20.8457 3.8345 19.2899 2.13477 17.3711 2.13477H14.5625L17.4512 6.08008Z" fill="url(#paint0_linear_779_6938)"/>
<defs>
<linearGradient id="paint0_linear_779_6938" x1="0" y1="12.4541" x2="22.7998" y2="12.4541" gradientUnits="userSpaceOnUse">
<stop stop-color="#1B2351"/>
<stop offset="1" stop-color="#47C0D2"/>
</linearGradient>
</defs>
</svg>
`;
const svgShop = `<svg width="23" height="23" viewBox="0 0 23 23" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_779_6944)">
<path d="M21.375 5.7H17.1V4.56C17.1 3.35061 16.4995 2.19076 15.4305 1.33559C14.3616 0.480427 12.9117 0 11.4 0C9.88827 0 8.43845 0.480427 7.36949 1.33559C6.30053 2.19076 5.7 3.35061 5.7 4.56V5.7H1.425C1.04707 5.7 0.684612 5.82011 0.417373 6.0339C0.150134 6.24769 0 6.53765 0 6.84L0 19.38C0 20.287 0.450401 21.1569 1.25212 21.7983C2.05384 22.4397 3.1412 22.8 4.275 22.8H18.525C19.6588 22.8 20.7462 22.4397 21.5479 21.7983C22.3496 21.1569 22.8 20.287 22.8 19.38V6.84C22.8 6.53765 22.6499 6.24769 22.3826 6.0339C22.1154 5.82011 21.7529 5.7 21.375 5.7ZM8.55 4.56C8.55 3.95531 8.85027 3.37538 9.38475 2.9478C9.91922 2.52021 10.6441 2.28 11.4 2.28C12.1559 2.28 12.8808 2.52021 13.4153 2.9478C13.9497 3.37538 14.25 3.95531 14.25 4.56V5.7H8.55V4.56ZM19.95 19.38C19.95 19.6823 19.7999 19.9723 19.5326 20.1861C19.2654 20.3999 18.9029 20.52 18.525 20.52H4.275C3.89707 20.52 3.53461 20.3999 3.26737 20.1861C3.00013 19.9723 2.85 19.6823 2.85 19.38L2.85 7.98H5.7L5.7 9.12C5.7 9.42235 5.85013 9.71231 6.11737 9.9261C6.38461 10.1399 6.74707 10.26 7.125 10.26C7.50293 10.26 7.86539 10.1399 8.13263 9.9261C8.39987 9.71231 8.55 9.42235 8.55 9.12V7.98H14.25V9.12C14.25 9.42235 14.4001 9.71231 14.6674 9.9261C14.9346 10.1399 15.2971 10.26 15.675 10.26C16.0529 10.26 16.4154 10.1399 16.6826 9.9261C16.9499 9.71231 17.1 9.42235 17.1 9.12V7.98H19.95V19.38Z" fill="url(#paint0_linear_779_6944)"/>
</g>
<defs>
<linearGradient id="paint0_linear_779_6944" x1="0" y1="11.4" x2="22.8" y2="11.4" gradientUnits="userSpaceOnUse">
<stop stop-color="#1B2351"/>
<stop offset="1" stop-color="#47C0D2"/>
</linearGradient>
<clipPath id="clip0_779_6944">
<rect width="22.8" height="22.8" fill="white"/>
</clipPath>
</defs>
</svg>
`;
const svgOffers = `<svg width="23" height="25" viewBox="0 0 23 25" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M19.6403 8.84819V3.65181H14.8698L11.4797 0L8.14034 3.65181H3.35966V8.84819L0 12.4779L3.35966 16.1628V21.3482H8.14034L11.4797 25L14.8698 21.3482H19.6403V16.1628L23 12.4779L19.6403 8.84819ZM8.26214 7.01677C9.25684 7.01677 10.0587 7.88835 10.0587 8.98058C10.0587 9.49849 9.86941 9.99519 9.53249 10.3614C9.19557 10.7276 8.73861 10.9334 8.26214 10.9334C7.25728 10.9334 6.45543 10.0618 6.45543 8.98058C6.45543 7.88835 7.25728 7.01677 8.26214 7.01677ZM14.748 17.9943C13.7533 17.9943 12.9515 17.1117 12.9515 16.0305C12.9515 15.5125 13.1407 15.0158 13.4777 14.6496C13.8146 14.2834 14.2715 14.0777 14.748 14.0777C15.7427 14.0777 16.5547 14.9493 16.5547 16.0305C16.5547 16.5513 16.3644 17.0508 16.0255 17.4191C15.6867 17.7874 15.2272 17.9943 14.748 17.9943ZM7.92718 18.0274L6.40468 16.3725L15.0627 6.96161L16.5852 8.6165L7.92718 18.0274Z" fill="url(#paint0_linear_779_6945)"/>
<defs>
<linearGradient id="paint0_linear_779_6945" x1="0" y1="12.5" x2="23" y2="12.5" gradientUnits="userSpaceOnUse">
<stop stop-color="#1B2351"/>
<stop offset="1" stop-color="#47C0D2"/>
</linearGradient>
</defs>
</svg>
`;
const svgCommint = `<svg width="25" height="25" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect width="25" height="25" fill="#F6F3EC"/>
<path d="M7.8127 8.85402H17.1877M7.8127 13.0207H13.5419M22.9169 10.9373C22.9169 10.1353 22.9023 9.35089 22.8752 8.5936C22.7887 6.12173 22.745 4.88527 21.7398 3.87172C20.7346 2.85922 19.4627 2.80506 16.921 2.69568C15.4482 2.63385 13.9743 2.60329 12.5002 2.60402C10.9585 2.60402 9.47415 2.63527 8.07936 2.69568C5.5377 2.80506 4.26686 2.85922 3.26061 3.87277C2.2554 4.88527 2.21165 6.12173 2.1252 8.5936C2.07025 10.1556 2.07025 11.7191 2.1252 13.2811C2.21165 15.753 2.2554 16.9894 3.26061 18.003C4.26582 19.0155 5.5377 19.0696 8.07936 19.179C8.84464 19.2117 9.63457 19.236 10.4492 19.2519C11.22 19.2665 11.6064 19.2728 11.946 19.403C12.2856 19.5332 12.571 19.7759 13.1419 20.2655L15.4117 22.2134C15.5221 22.3081 15.6574 22.369 15.8015 22.3891C15.9456 22.4092 16.0924 22.3875 16.2246 22.3266C16.3567 22.2658 16.4686 22.1683 16.547 22.0458C16.6254 21.9232 16.667 21.7807 16.6669 21.6353V19.1894L16.921 19.179C19.4627 19.0696 20.7335 19.0155 21.7398 18.0019C22.745 16.9894 22.7887 15.753 22.8752 13.2811C22.9023 12.5238 22.9169 11.7394 22.9169 10.9373Z" stroke="url(#paint0_linear_779_6946)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
<defs>
<linearGradient id="paint0_linear_779_6946" x1="2.08398" y1="12.5002" x2="22.9169" y2="12.5002" gradientUnits="userSpaceOnUse">
<stop stop-color="#1B2351"/>
<stop offset="1" stop-color="#47C0D2"/>
</linearGradient>
</defs>
</svg>
`;
const svgPolicy = `<svg width="23" height="25" viewBox="0 0 23 25" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M10.1211 24.7147C9.99003 24.7147 9.85171 24.6983 9.70615 24.6657C9.5606 24.6331 9.42517 24.5935 9.29986 24.5469C6.43703 23.4981 4.17135 21.7194 2.50281 19.2107C0.834269 16.702 0 13.9864 0 11.0638V5.07466C0 4.59549 0.141214 4.16386 0.423641 3.77977C0.705105 3.39569 1.06995 3.11742 1.51817 2.94495L9.3042 0.148226C9.58566 0.0494087 9.85797 0 10.1211 0C10.3843 0 10.6571 0.0494087 10.9395 0.148226L18.7241 2.94495C19.1713 3.11835 19.5362 3.39662 19.8186 3.77977C20.101 4.16386 20.2422 4.59549 20.2422 5.07466V9.14949C20.2422 9.34712 20.1728 9.51306 20.034 9.6473C19.8952 9.78155 19.7232 9.84867 19.5179 9.84867C19.3125 9.84867 19.141 9.78155 19.0031 9.6473C18.8653 9.51306 18.7964 9.34712 18.7964 9.14949V5.04809C18.7964 4.8691 18.7453 4.70782 18.6431 4.56426C18.5419 4.42069 18.3983 4.31348 18.2122 4.24263L10.4276 1.44591C10.3351 1.40862 10.2329 1.38997 10.1211 1.38997C10.0093 1.38997 9.90713 1.40862 9.81459 1.44591L2.03001 4.24263C1.84397 4.31348 1.70035 4.42069 1.59914 4.56426C1.49696 4.70782 1.44587 4.8691 1.44587 5.04809V11.0638C1.44587 13.8839 2.2652 16.4475 3.90386 18.7548C5.54252 21.0621 7.61494 22.6003 10.1211 23.3694C10.6185 23.2175 11.1 23.0329 11.5655 22.8157C12.0321 22.5985 12.4924 22.3402 12.9464 22.041C13.117 21.9263 13.3049 21.8802 13.5102 21.9026C13.7156 21.9259 13.8809 22.0168 14.0062 22.1752C14.117 22.3402 14.1517 22.515 14.1103 22.6996C14.0698 22.8833 13.9671 23.0268 13.8023 23.1303C13.3396 23.41 12.8765 23.6738 12.4128 23.9218C11.9492 24.1707 11.4624 24.3884 10.9525 24.5748C10.8195 24.6214 10.6807 24.6564 10.5361 24.6797C10.3915 24.703 10.2532 24.7147 10.1211 24.7147ZM22.0771 24.9076C21.8717 24.9076 21.7002 24.8405 21.5623 24.7063C21.4245 24.572 21.3551 24.4056 21.3541 24.2071C21.3532 24.0085 21.4226 23.8425 21.5623 23.7092C21.7021 23.5759 21.8741 23.5093 22.0785 23.5093C22.2829 23.5093 22.4544 23.5764 22.5932 23.7106C22.732 23.8449 22.801 24.0113 22.8 24.2099C22.799 24.4084 22.7296 24.5744 22.5918 24.7077C22.4539 24.841 22.2824 24.9076 22.0771 24.9076ZM21.3541 19.4764V13.8829C21.3541 13.6844 21.4235 13.518 21.5623 13.3837C21.7011 13.2504 21.8732 13.1838 22.0785 13.1838C22.2838 13.1838 22.4554 13.2504 22.5932 13.3837C22.7311 13.517 22.8 13.6834 22.8 13.8829V19.4764C22.8 19.674 22.7306 19.84 22.5918 19.9742C22.453 20.1085 22.2814 20.1751 22.0771 20.1742C21.8727 20.1732 21.7011 20.1066 21.5623 19.9742C21.4235 19.8418 21.3541 19.6768 21.3541 19.4764ZM10.1211 15.1191C10.9164 15.1191 11.5974 14.8455 12.1641 14.2983C12.7309 13.751 13.0138 13.0924 13.0129 12.3224C13.0119 11.5523 12.729 10.8942 12.1641 10.3479C11.5993 9.80159 10.9183 9.52751 10.1211 9.52565C9.32396 9.52378 8.64344 9.79786 8.07955 10.3479C7.51565 10.8979 7.23226 11.5561 7.22937 12.3224C7.22648 13.0887 7.50987 13.7473 8.07955 14.2983C8.64922 14.8492 9.32974 15.1228 10.1211 15.1191ZM10.1211 16.5175C8.92875 16.5175 7.90749 16.1068 7.05731 15.2855C6.20714 14.4642 5.78253 13.4765 5.7835 12.3224C5.78446 11.1683 6.20907 10.1805 7.05731 9.35924C7.90556 8.53794 8.92683 8.12728 10.1211 8.12728C11.3154 8.12728 12.3367 8.53794 13.1849 9.35924C14.0332 10.1805 14.4578 11.1683 14.4587 12.3224C14.4587 12.754 14.3927 13.1707 14.2607 13.5725C14.1276 13.9743 13.9474 14.3519 13.7199 14.7052L17.3621 18.2277C17.5028 18.3638 17.578 18.5255 17.5876 18.7129C17.5963 18.9003 17.5211 19.0713 17.3621 19.2261C17.202 19.3799 17.0314 19.4568 16.8502 19.4568C16.669 19.4568 16.4984 19.3799 16.3384 19.2261L12.6803 15.6952C12.3198 15.9693 11.9203 16.1749 11.4817 16.3119C11.0431 16.4489 10.5896 16.5175 10.1211 16.5175Z" fill="url(#paint0_linear_779_6948)"/>
<defs>
<linearGradient id="paint0_linear_779_6948" x1="0" y1="12.4538" x2="22.8" y2="12.4538" gradientUnits="userSpaceOnUse">
<stop stop-color="#1B2351"/>
<stop offset="1" stop-color="#47C0D2"/>
</linearGradient>
</defs>
</svg>
`;

const svgSortTriangle = `<svg width="7" height="6" viewBox="0 0 7 6" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M3.46387 5.25L-0.000234604 0L6.92797 0L3.46387 5.25Z" fill="#1B2351"/>
</svg>`;

const tabsData: { key: Tab; xml: string; size?: { w: number; h: number } }[] = [
  { key: "reels", xml: svgReels, size: { w: 23, h: 25 } },
  { key: "shop", xml: svgShop, size: { w: 23, h: 23 } },
  { key: "offers", xml: svgOffers, size: { w: 23, h: 25 } },
  { key: "Commint", xml: svgCommint, size: { w: 25, h: 25 } },
  { key: "Policy", xml: svgPolicy, size: { w: 23, h: 25 } },
];

const BrandTabsBar: React.FC<Props> = ({
  activeTab,
  onTabChange,
  onReelsSortChange,
}) => {
  const [reelsSort, setReelsSort] = useState<"popular" | "oldest">("popular");

  const handlePress = (tab: Tab) => (_e: GestureResponderEvent) => {
    onTabChange(tab);
  };

  const toggleReelsSort = () => {
    const next = reelsSort === "popular" ? "oldest" : "popular";
    setReelsSort(next);
    if (onReelsSortChange) onReelsSortChange(next);
  };

  return (
    <View style={styles.container}>
      {tabsData.map(({ key, xml, size }) => {
        const isActive = activeTab === key;
        if (key === "reels") {
          return (
            <View key={key} style={styles.reelsWrapper}>
              <TouchableOpacity
                onPress={handlePress(key)}
                style={styles.tabButton}
                activeOpacity={0.8}
              >
                <View style={styles.iconWrapper}>
                  <SvgXml
                    xml={xml}
                    width={size?.w ?? 24}
                    height={size?.h ?? 24}
                    style={isActive ? styles.iconActive : styles.iconInactive}
                  />
                  <View
                    style={[
                      styles.indicator,
                      isActive && styles.indicatorActive,
                    ]}
                  />
                </View>
              </TouchableOpacity>

              {/* small toggle button */}
              <TouchableOpacity
                onPress={toggleReelsSort}
                activeOpacity={0.8}
              >
                <SvgXml xml={svgSortTriangle} width={8} height={7} />
              </TouchableOpacity>
            </View>
          );
        }

        // default tabs
        return (
          <TouchableOpacity
            key={key}
            onPress={handlePress(key)}
            style={styles.tabButton}
            activeOpacity={0.8}
          >
            <View style={styles.iconWrapper}>
              <SvgXml
                xml={xml}
                width={size?.w ?? 24}
                height={size?.h ?? 24}
                style={isActive ? styles.iconActive : styles.iconInactive}
              />
              <View
                style={[
                  styles.indicator,
                  isActive && styles.indicatorActive,
                ]}
              />
            </View>
          </TouchableOpacity>
        );
      })}
    </View>
  );
};

export default BrandTabsBar;

const styles = StyleSheet.create({
  container: {
    flexDirection: "row",
    justifyContent: "center", 
    alignItems: "center",
  },
  reelsWrapper: {
    flexDirection: "row",
    alignItems: "center",
    marginHorizontal: 6,
  },
  tabButton: {
    paddingHorizontal: 10,
    borderRadius: 8,
  },
  iconWrapper: {
    alignItems: "center",
    justifyContent: "center",
  },
  iconActive: {
    opacity: 1,
    transform: [{ scale: 1.03 }],
  },
  iconInactive: {
    opacity: 0.75,
  },
  indicator: {
    marginTop: 6,
    width: 26,
    height: 4,
    borderRadius: 2,
    backgroundColor: "transparent",
    opacity: 1,
  },
  indicatorActive: {
    backgroundColor: lightColors.primary,
    borderRadius: 10,
  },
});